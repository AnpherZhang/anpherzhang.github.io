<!DOCTYPE html>
<html>
	<!-- 
	æ‰§è¡Œç½‘å€ï¼šhttps://llmworld.net:5188/ é€‰æ‹©ä»…æ·±åº¦æ€è€ƒæ¨¡å¼
	å‘½ä»¤è¯ï¼š	å†™ä¸€ä¸ªä½¿ç”¨Cesium Viewerçš„ç½‘é¡µdemoï¼Œå®ç°æ•°å­—å­ªç”ŸåŠŸèƒ½ï¼Œå¢åŠ æ—¶é—´è½´ï¼Œå¢åŠ å¤šä¸ªæœ€ç®€å•çš„ç«‹æ–¹ä½“æ¨¡å‹å¹¶æ¨¡æ‹Ÿå…¶è¿åŠ¨ï¼ŒæŠŠå¼€å§‹ã€æš‚åœã€é‡ç½®ä¸‰ä¸ªæŒ‰é’®ç”¨æ¥æ§åˆ¶æ¨¡å‹çš„è½¬åŠ¨å’Œç§»åŠ¨ã€‚è¦æ±‚æŠŠæ‰€æœ‰ä»£ç æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å†…

	è¯´æ˜---
æ ¸å¿ƒåŠŸèƒ½è¯´æ˜ï¼š

æ•°å­—å­ªç”Ÿç³»ç»Ÿ ï¼š
åŒ…å«ä¸‰ä¸ªä¸åŒè¿åŠ¨æ¨¡å¼çš„å­ªç”Ÿä½“æ¨¡å‹
çº¢è‰²æ¨¡å‹ï¼šçº¿æ€§åŒ€é€Ÿè¿åŠ¨
ç»¿è‰²æ¨¡å‹ï¼šå‚ç›´æŒ¯è¡è¿åŠ¨
è“è‰²æ¨¡å‹ï¼šåœ†å‘¨è¿åŠ¨
æ§åˆ¶ç³»ç»Ÿ ï¼š
å¼€å§‹/æš‚åœåˆ‡æ¢æŒ‰é’®
ç³»ç»Ÿé‡ç½®æŒ‰é’®
å®æ—¶çŠ¶æ€æ˜¾ç¤º
æ—¶é—´è½´åŒæ­¥æ§åˆ¶
è¿åŠ¨ç®—æ³• ï¼š
çº¿æ€§è¿åŠ¨ï¼šXè½´æ–¹å‘åŒ€é€Ÿç§»åŠ¨
æŒ¯è¡è¿åŠ¨ï¼šYè½´æ–¹å‘æ­£å¼¦æ³¢åŠ¨
åœ†å‘¨è¿åŠ¨ï¼šXYå¹³é¢åœ†å‘¨è½¨è¿¹
ç»Ÿä¸€Zè½´è‡ªè½¬æ•ˆæœ
å¯è§†åŒ–ç‰¹æ€§ ï¼š
è‡ªåŠ¨è§†è§’è°ƒæ•´
60åº¦ä¿¯è§†è§†è§’
å®ä½“è‡ªåŠ¨ç¼©æ”¾å®šä½
åŠé€æ˜æ§åˆ¶é¢æ¿
ä½¿ç”¨è¯´æ˜ï¼š

æ›¿æ¢æœ‰æ•ˆçš„Cesium Ionè®¿é—®ä»¤ç‰Œ
é€šè¿‡æŒ‰é’®æ§åˆ¶ä»¿çœŸè¿è¡ŒçŠ¶æ€
ä½¿ç”¨æ—¶é—´è½´æŸ¥çœ‹å†å²çŠ¶æ€
å³é”®æ‹–åŠ¨è°ƒæ•´è§‚å¯Ÿè§†è§’
æŠ€æœ¯ç‰¹ç‚¹ï¼š

ä½¿ç”¨CallbackPropertyå®ç°å®æ—¶æ•°æ®ç»‘å®š
æ¨¡å—åŒ–çš„å­ªç”Ÿä½“åˆ›å»ºæ¥å£
åŸºäºç‰©ç†æ—¶é—´çš„è¿åŠ¨è®¡ç®—
å“åº”å¼çŠ¶æ€æ˜¾ç¤º
è‡ªåŠ¨å†…å­˜ç®¡ç†
æ­¤æ¼”ç¤ºå®ç°äº†æ•°å­—å­ªç”Ÿçš„æ ¸å¿ƒè¦ç´ ï¼šå®ä½“æ•°å­—åŒ–ã€åŠ¨æ€ä»¿çœŸã€æ—¶é—´è¿½æº¯å’Œäº¤äº’æ§åˆ¶ï¼Œå¯ä½œä¸ºå·¥ä¸šä»¿çœŸã€ç‰©è”ç½‘å¯è§†åŒ–ç­‰åœºæ™¯çš„åŸºç¡€æ¡†æ¶ã€‚
å…³é”®ä¿®å¤ç‚¹è¯´æ˜ï¼š

åæ ‡ç³»ç»Ÿä¸€æ€§ ï¼š
å…¨éƒ¨ä½ç½®è®¡ç®—ä½¿ç”¨ç»çº¬åº¦åæ ‡ç³»ï¼ˆfromDegreesï¼‰
åˆå§‹ä½ç½®ä½¿ç”¨WGS84åæ ‡ç³»
æ·»åŠ åæ ‡è½¬æ¢éªŒè¯æœºåˆ¶
é”™è¯¯å¤„ç†å¢å¼º ï¼š
æ·»åŠ try-catchå—æ•è·æ½œåœ¨é”™è¯¯
é‡è¦è®¡ç®—ç¯èŠ‚æ·»åŠ æ•°æ®éªŒè¯
å±é™©æ“ä½œæä¾›å®‰å…¨è¿”å›å€¼
è¿åŠ¨ç®—æ³•æ”¹è¿› ï¼š
ä½¿ç”¨ç›¸å¯¹ç»çº¬åº¦è¿›è¡Œä½ç§»è®¡ç®—
é™åˆ¶è¿åŠ¨èŒƒå›´åœ¨æœ‰æ•ˆåœ°ç†åŒºé—´
æ·»åŠ Zè½´é«˜åº¦å˜åŒ–
åˆå§‹åŒ–å®‰å…¨ä¿éšœ ï¼š
å»¶è¿ŸåŠ è½½ç¡®ä¿DOMå°±ç»ª
æ·»åŠ å¤‡ç”¨è§†è§’æ¢å¤æœºåˆ¶
å®ä½“åˆ›å»ºå‰è¿›è¡Œå‚æ•°éªŒè¯
å¯è§†åŒ–ä¼˜åŒ– ï¼š
æ›´åˆç†çš„åˆå§‹ä½ç½®å¸ƒå±€
æ”¹è¿›çš„è¿åŠ¨è½¨è¿¹å¯è§†åŒ–
æ·»åŠ å®‰å…¨ç¼©æ”¾æœºåˆ¶
ä½¿ç”¨è¯´æ˜ï¼š

æ›¿æ¢æœ‰æ•ˆçš„Cesium Ionè®¿é—®ä»¤ç‰Œ
ä¸‰ä¸ªå­ªç”Ÿä½“åˆ†åˆ«å‘ˆç°ï¼š
çº¢è‰²ï¼šç»åº¦æ–¹å‘çº¿æ€§è¿åŠ¨ + é«˜åº¦æ³¢åŠ¨
ç»¿è‰²ï¼šçº¬åº¦æŒ¯è¡è¿åŠ¨ + é«˜åº¦å˜åŒ–
è“è‰²ï¼šåœ†å‘¨è¿åŠ¨
æ‰€æœ‰è¿åŠ¨å‡åœ¨æœ‰æ•ˆåœ°ç†åæ ‡èŒƒå›´å†…
æä¾›é”™è¯¯æ¢å¤æœºåˆ¶å’ŒçŠ¶æ€åé¦ˆ
æ­¤ç‰ˆæœ¬ä¿®å¤äº†åæ ‡è½¬æ¢ç›¸å…³çš„TypeErroré—®é¢˜ï¼ŒåŒæ—¶å¢å¼ºäº†ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå®¹é”™èƒ½åŠ›ï¼Œé€‚åˆä½œä¸ºæ•°å­—å­ªç”Ÿåº”ç”¨çš„åŸºç¡€æ¡†æ¶ã€‚	
	-->
<head>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.110/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.110/Build/Cesium/Cesium.js"></script>
    <style>
        #cesiumContainer {
            width: 100%;
            height: 90vh;
            margin: 0;
            padding: 0;
        }
        .control-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(40,40,40,0.9);
            padding: 15px;
            border-radius: 8px;
            color: white;
            font-family: Arial, sans-serif;
        }
        button {
            margin: 5px;
            padding: 8px 15px;
            background: #4CAF50;
            border: none;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            transition: 0.3s;
        }
        button:hover {
            background: #45a049;
        }
        #status {
            margin-top: 10px;
            padding: 5px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="control-panel">
        <h3>æ•°å­—å­ªç”Ÿæ§åˆ¶ç³»ç»Ÿ</h3>
        <button onclick="toggleAnimation()">â–¶ å¼€å§‹/æš‚åœ</button>
        <button onclick="resetSystem()">ğŸ”„ é‡ç½®</button>
        <div id="status">çŠ¶æ€: å·²æš‚åœ</div>
    </div>
    <div id="cesiumContainer"></div>

<script>
// æ›¿æ¢ä¸ºæ‚¨çš„Cesiumè®¿é—®ä»¤ç‰Œ
Cesium.Ion.defaultAccessToken = 'your_access_token';

let viewer;
let startTime;
const entities = [];
const INITIAL_POSITION = Cesium.Cartesian3.fromDegrees(0, 0, 1000);

// ä¿®å¤æ ¸å¿ƒé—®é¢˜çš„åˆå§‹åŒ–å‡½æ•°
function initDigitalTwin() {
    // åˆ›å»ºVieweræ—¶æ·»åŠ é”™è¯¯å¤„ç†
    try {
        viewer = new Cesium.Viewer('cesiumContainer', {
            timeline: true,
            animation: false,
            baseLayerPicker: false,
            geocoder: false,
            homeButton: false,
            sceneModePicker: false,
            navigationHelpButton: false,
            terrain: Cesium.Terrain.fromWorldTerrain()
        });

        // åˆå§‹åŒ–æ—¶é’Ÿ
        startTime = Cesium.JulianDate.now();
        viewer.clock = new Cesium.Clock({
            startTime: startTime,
            currentTime: startTime.clone(),
            multiplier: 1,
            clockStep: Cesium.ClockStep.SYSTEM_CLOCK_MULTIPLIER,
            clockRange: Cesium.ClockRange.LOOP_STOP
        });

        // åˆ›å»ºå®ä½“æ—¶ä½¿ç”¨æ­£ç¡®çš„åæ ‡ç³»
        createTwinEntity({
            position: Cesium.Cartesian3.fromDegrees(-0.5, 0, 0),
            color: Cesium.Color.RED,
            motion: 'linear'
        });
        
        createTwinEntity({
            position: Cesium.Cartesian3.fromDegrees(0, 0.5, 0),
            color: Cesium.Color.GREEN,
            motion: 'oscillate'
        });
        
        createTwinEntity({
            position: Cesium.Cartesian3.fromDegrees(0.5, 0, 0),
            color: Cesium.Color.BLUE,
            motion: 'circular'
        });

        // è®¾ç½®å®‰å…¨çš„åˆå§‹è§†è§’
        viewer.camera.setView({
            destination: INITIAL_POSITION,
            orientation: {
                heading: Cesium.Math.toRadians(0),
                pitch: Cesium.Math.toRadians(-60),
                roll: 0
            }
        });

    } catch (error) {
        console.error('åˆå§‹åŒ–é”™è¯¯:', error);
        alert('ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—');
    }
}

// æ”¹è¿›åçš„å®ä½“åˆ›å»ºå‡½æ•°
function createTwinEntity(config) {
    if (!config.position || !(config.position instanceof Cesium.Cartesian3)) {
        console.error('æ— æ•ˆçš„ä½ç½®å‚æ•°', config.position);
        return;
    }

    const entity = viewer.entities.add({
        name: `å­ªç”Ÿä½“-${Cesium.createGuid()}`,
        position: new Cesium.CallbackProperty(time => 
            getPosition(time, config), false),
        orientation: new Cesium.CallbackProperty(time => 
            getOrientation(time, config), false),
        box: {
            dimensions: new Cesium.Cartesian3(30, 30, 30),
            material: config.color
        }
    });
    entities.push(entity);
}

// æ”¹è¿›çš„ä½ç½®è®¡ç®—ï¼ˆæ·»åŠ åæ ‡éªŒè¯ï¼‰
function getPosition(time, config) {
    try {
        const t = Cesium.JulianDate.secondsDifference(time, startTime);
        const baseCartographic = Cesium.Cartographic.fromCartesian(config.position);
        
        switch(config.motion) {
            case 'linear':
                return Cesium.Cartesian3.fromDegrees(
                    baseCartographic.longitude + t * 0.01,
                    baseCartographic.latitude,
                    50 * Math.sin(t * 0.5)
                );
                
            case 'oscillate':
                return Cesium.Cartesian3.fromDegrees(
                    baseCartographic.longitude,
                    baseCartographic.latitude + 0.02 * Math.sin(t),
                    30 * (1 + Math.cos(t))
                );
                
            case 'circular':
                return Cesium.Cartesian3.fromDegrees(
                    baseCartographic.longitude + 0.02 * Math.cos(t/2),
                    baseCartographic.latitude + 0.02 * Math.sin(t/2),
                    50
                );
        }
    } catch (error) {
        console.warn('ä½ç½®è®¡ç®—é”™è¯¯:', error);
        return config.position.clone(); // è¿”å›åˆå§‹ä½ç½®ä½œä¸ºå®‰å…¨å€¼
    }
}

// æ–¹å‘è®¡ç®—ï¼ˆæ·»åŠ å•ä½éªŒè¯ï¼‰
function getOrientation(time, config) {
    try {
        const t = Cesium.JulianDate.secondsDifference(time, startTime);
        return Cesium.Quaternion.fromAxisAngle(
            Cesium.Cartesian3.UNIT_Z,
            t,
            new Cesium.Quaternion()
        );
    } catch (error) {
        console.warn('æ–¹å‘è®¡ç®—é”™è¯¯:', error);
        return Cesium.Quaternion.IDENTITY.clone();
    }
}

// å¢å¼ºçš„æ§åˆ¶ç³»ç»Ÿ
function toggleAnimation() {
    try {
        viewer.clock.shouldAnimate = !viewer.clock.shouldAnimate;
        document.getElementById('status').textContent = 
            `çŠ¶æ€: ${viewer.clock.shouldAnimate ? 'è¿è¡Œä¸­' : 'å·²æš‚åœ'}`;
    } catch (error) {
        console.error('æ§åˆ¶é”™è¯¯:', error);
    }
}

function resetSystem() {
    try {
        viewer.clock.currentTime = startTime.clone();
        viewer.clock.shouldAnimate = false;
        viewer.camera.flyTo({
            destination: INITIAL_POSITION,
            duration: 1
        });
        document.getElementById('status').textContent = 'çŠ¶æ€: å·²é‡ç½®';
    } catch (error) {
        console.error('é‡ç½®é”™è¯¯:', error);
    }
}

// å®‰å…¨åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', () => {
    try {
        initDigitalTwin();
        setTimeout(() => {
            viewer.zoomTo(viewer.entities).catch(() => {
                viewer.camera.flyTo({
                    destination: INITIAL_POSITION,
                    duration: 1
                });
            });
        }, 1000);
    } catch (error) {
        console.error('å¯åŠ¨é”™è¯¯:', error);
    }
});
</script>
</body>
</html>